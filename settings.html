<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Auto Countdown - Param√®tres</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 16px;
            margin: 0;
            background: #1d2125;
            color: #b6c2cf;
            font-size: 14px;
        }
        h3 {
            margin: 0 0 16px 0;
            color: #fff;
            font-size: 16px;
            border-bottom: 1px solid #3d444d;
            padding-bottom: 8px;
        }
        .section { margin-bottom: 20px; }
        .section-title {
            font-weight: 600;
            color: #9fadbc;
            margin-bottom: 10px;
            font-size: 12px;
            text-transform: uppercase;
        }
        .row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        .row label { flex: 1; color: #b6c2cf; }
        .color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            vertical-align: middle;
        }
        input[type="number"], input[type="text"] {
            padding: 6px 10px;
            border: 1px solid #3d444d;
            border-radius: 4px;
            background: #22272b;
            color: #b6c2cf;
            font-size: 14px;
        }
        input[type="number"] { width: 70px; }
        input[type="text"] { width: 140px; }
        input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        select {
            padding: 6px 10px;
            border: 1px solid #3d444d;
            border-radius: 4px;
            background: #22272b;
            color: #b6c2cf;
            font-size: 14px;
            cursor: pointer;
        }
        .color-select { width: 100px; }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
            margin-top: 10px;
        }
        .btn-primary { background: #579dff; color: #1d2125; }
        .btn-primary:hover { background: #85b8ff; }
        .btn-secondary { background: #3d444d; color: #b6c2cf; margin-top: 8px; }
        .btn-secondary:hover { background: #4d555e; }
        .success-message {
            background: #1f6f4a;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        .format-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid #3d444d;
            border-radius: 4px;
            margin-bottom: 6px;
            cursor: pointer;
        }
        .format-option:hover { border-color: #579dff; }
        .format-option.selected {
            border-color: #579dff;
            background: rgba(87, 157, 255, 0.1);
        }
        .format-option input { margin: 0; }
        .format-example { color: #8c9bab; font-size: 12px; }
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 8px 10px;
            background: #22272b;
            border: 1px solid #3d444d;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #9fadbc;
        }
        .tab.active {
            background: #579dff;
            color: #1d2125;
            border-color: #579dff;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .badge-preview {
            background: #22272b;
            border-radius: 6px;
            padding: 12px;
            margin: 12px 0;
            border: 1px solid #3d444d;
        }
        .badge-preview-title {
            font-size: 11px;
            color: #8c9bab;
            margin-bottom: 8px;
        }
        .badge-sample {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: #fff;
        }
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #22272b;
            border-radius: 6px;
            margin-bottom: 12px;
        }
        .toggle-label { font-weight: 500; }
        .emoji-btn {
            background: #3d444d;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 2px;
        }
        .emoji-btn:hover { background: #4d555e; }
        .info-box {
            background: rgba(87, 157, 255, 0.1);
            border: 1px solid #579dff;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 12px;
            font-size: 12px;
            color: #85b8ff;
        }
    </style>
</head>
<body>
    <h3>‚è±Ô∏è Auto Countdown v4</h3>
    
    <div class="info-box">
        ‚úÖ Version 4 avec couleurs vives (red_dark, orange_dark, etc.) - Testez si elles fonctionnent !
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="alert">üö® Alerte</div>
        <div class="tab" data-tab="colors">üé® Couleurs</div>
        <div class="tab" data-tab="thresholds">‚è∞ Seuils</div>
    </div>
    
    <!-- Onglet Alerte -->
    <div id="tab-alert" class="tab-content active">
        <div class="toggle-row">
            <span class="toggle-label">Badge "EN RETARD" visible</span>
            <input type="checkbox" id="alert-enabled" checked>
        </div>
        
        <div id="alert-options">
            <div class="section">
                <div class="section-title">Texte du badge</div>
                <input type="text" id="alert-text" value="‚ö†Ô∏è EN RETARD" style="width: 100%;">
                <div id="emoji-suggestions" style="margin-top: 8px;">
                    <span class="emoji-btn">‚ö†Ô∏è</span>
                    <span class="emoji-btn">üî•</span>
                    <span class="emoji-btn">üö®</span>
                    <span class="emoji-btn">‚è∞</span>
                    <span class="emoji-btn">‚ùó</span>
                    <span class="emoji-btn">‚ùå</span>
                    <span class="emoji-btn">üíÄ</span>
                    <span class="emoji-btn">üÜò</span>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Couleur du badge</div>
                <div class="row">
                    <span class="color-dot" id="dot-alert"></span>
                    <select id="alert-color" class="color-select">
                        <option value="red_dark">üî¥ Rouge vif</option>
                        <option value="red">üî¥ Rouge</option>
                        <option value="orange_dark">üü† Orange vif</option>
                        <option value="orange">üü† Orange</option>
                        <option value="yellow_dark">üü° Jaune vif</option>
                        <option value="yellow">üü° Jaune</option>
                        <option value="pink_dark">üíó Rose vif</option>
                        <option value="pink">üíó Rose</option>
                        <option value="purple_dark">üü£ Violet vif</option>
                        <option value="purple">üü£ Violet</option>
                    </select>
                </div>
            </div>
            
            <div class="badge-preview">
                <div class="badge-preview-title">Aper√ßu :</div>
                <span class="badge-sample" id="badge-preview-sample">‚ö†Ô∏è EN RETARD</span>
            </div>
        </div>
    </div>
    
    <!-- Onglet Couleurs -->
    <div id="tab-colors" class="tab-content">
        <div class="section">
            <div class="section-title">Couleurs par statut</div>
            
            <div class="row">
                <label><span class="color-dot" id="dot-overdue"></span>En retard</label>
                <select id="color-overdue" class="color-select">
                    <option value="red_dark">üî¥ Rouge vif</option>
                    <option value="red">üî¥ Rouge</option>
                    <option value="red_light">üî¥ Rouge clair</option>
                    <option value="orange_dark">üü† Orange vif</option>
                    <option value="orange">üü† Orange</option>
                    <option value="yellow_dark">üü° Jaune vif</option>
                    <option value="yellow">üü° Jaune</option>
                    <option value="pink_dark">üíó Rose vif</option>
                    <option value="pink">üíó Rose</option>
                    <option value="purple_dark">üü£ Violet vif</option>
                    <option value="purple">üü£ Violet</option>
                    <option value="blue">üîµ Bleu</option>
                    <option value="green">üü¢ Vert</option>
                    <option value="sky">ü©µ Cyan</option>
                </select>
            </div>
            
            <div class="row">
                <label><span class="color-dot" id="dot-urgent"></span>Urgent (< 24h)</label>
                <select id="color-urgent" class="color-select">
                    <option value="red_dark">üî¥ Rouge vif</option>
                    <option value="red">üî¥ Rouge</option>
                    <option value="orange_dark" selected>üü† Orange vif</option>
                    <option value="orange">üü† Orange</option>
                    <option value="yellow_dark">üü° Jaune vif</option>
                    <option value="yellow">üü° Jaune</option>
                    <option value="pink_dark">üíó Rose vif</option>
                    <option value="pink">üíó Rose</option>
                    <option value="purple_dark">üü£ Violet vif</option>
                    <option value="purple">üü£ Violet</option>
                    <option value="blue">üîµ Bleu</option>
                    <option value="green">üü¢ Vert</option>
                    <option value="sky">ü©µ Cyan</option>
                </select>
            </div>
            
            <div class="row">
                <label><span class="color-dot" id="dot-warning"></span>Attention (< 72h)</label>
                <select id="color-warning" class="color-select">
                    <option value="red_dark">üî¥ Rouge vif</option>
                    <option value="red">üî¥ Rouge</option>
                    <option value="orange_dark">üü† Orange vif</option>
                    <option value="orange">üü† Orange</option>
                    <option value="yellow_dark" selected>üü° Jaune vif</option>
                    <option value="yellow">üü° Jaune</option>
                    <option value="pink_dark">üíó Rose vif</option>
                    <option value="pink">üíó Rose</option>
                    <option value="purple_dark">üü£ Violet vif</option>
                    <option value="purple">üü£ Violet</option>
                    <option value="blue">üîµ Bleu</option>
                    <option value="green">üü¢ Vert</option>
                    <option value="sky">ü©µ Cyan</option>
                </select>
            </div>
            
            <div class="row">
                <label><span class="color-dot" id="dot-normal"></span>Normal</label>
                <select id="color-normal" class="color-select">
                    <option value="red_dark">üî¥ Rouge vif</option>
                    <option value="red">üî¥ Rouge</option>
                    <option value="orange_dark">üü† Orange vif</option>
                    <option value="orange">üü† Orange</option>
                    <option value="yellow_dark">üü° Jaune vif</option>
                    <option value="yellow">üü° Jaune</option>
                    <option value="pink_dark">üíó Rose vif</option>
                    <option value="pink">üíó Rose</option>
                    <option value="purple_dark">üü£ Violet vif</option>
                    <option value="purple">üü£ Violet</option>
                    <option value="blue" selected>üîµ Bleu</option>
                    <option value="blue_dark">üîµ Bleu vif</option>
                    <option value="green">üü¢ Vert</option>
                    <option value="green_dark">üü¢ Vert vif</option>
                    <option value="sky">ü©µ Cyan</option>
                    <option value="lime">üíö Citron</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- Onglet Seuils -->
    <div id="tab-thresholds" class="tab-content">
        <div class="section">
            <div class="section-title">Seuils de temps</div>
            
            <div class="row">
                <label>Seuil urgent</label>
                <input type="number" id="threshold-urgent" value="24" min="1" max="168">
                <span>heures</span>
            </div>
            
            <div class="row">
                <label>Seuil attention</label>
                <input type="number" id="threshold-warning" value="72" min="1" max="336">
                <span>heures</span>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Format d'affichage</div>
            
            <div class="format-option selected" data-format="short">
                <input type="radio" name="format" id="format-short" value="short" checked>
                <div>
                    <strong>Court</strong>
                    <div class="format-example">Ex: "2j 5h" ou "3h 25m"</div>
                </div>
            </div>
            
            <div class="format-option" data-format="long">
                <input type="radio" name="format" id="format-long" value="long">
                <div>
                    <strong>Long</strong>
                    <div class="format-example">Ex: "2 jours 5 heures"</div>
                </div>
            </div>
        </div>
    </div>
    
    <button class="btn btn-primary" id="save-btn">üíæ Enregistrer</button>
    <button class="btn btn-secondary" id="reset-btn">üîÑ R√©initialiser</button>
    
    <div class="success-message" id="success-message">‚úÖ Param√®tres enregistr√©s !</div>
    
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
        var t = TrelloPowerUp.iframe();
        
        var DEFAULT_SETTINGS = {
            thresholds: { urgent: 24, warning: 72 },
            colors: { overdue: 'red_dark', urgent: 'orange_dark', warning: 'yellow_dark', normal: 'blue' },
            format: 'short',
            overdueAlert: { enabled: true, text: '‚ö†Ô∏è EN RETARD', color: 'red_dark' }
        };
        
        var colorCSS = {
            // Couleurs de base
            red: '#f87168',
            orange: '#faa53d',
            yellow: '#f5cd47',
            blue: '#579dff',
            green: '#4bce97',
            purple: '#9f8fef',
            pink: '#e774bb',
            sky: '#6cc3e0',
            lime: '#4fd582',
            black: '#626f86',
            // Couleurs DARK (vives) - comme les √©tiquettes Trello
            red_dark: '#cf513d',
            orange_dark: '#e79217',
            yellow_dark: '#e7c60b',
            blue_dark: '#036aa7',
            green_dark: '#59ac44',
            purple_dark: '#a86cc1',
            pink_dark: '#e668af',
            sky_dark: '#03aecc',
            lime_dark: '#4fd582',
            black_dark: '#081f42',
            // Couleurs LIGHT (pastel)
            red_light: '#f5d3ce',
            orange_light: '#fce8d4',
            yellow_light: '#faf3c0',
            blue_light: '#d4e5f7',
            green_light: '#d4f7e0',
            purple_light: '#e8dff5',
            pink_light: '#f7ddef',
            sky_light: '#d4f1f7'
        };
        
        function updateColorDots() {
            document.getElementById('dot-overdue').style.background = colorCSS[document.getElementById('color-overdue').value];
            document.getElementById('dot-urgent').style.background = colorCSS[document.getElementById('color-urgent').value];
            document.getElementById('dot-warning').style.background = colorCSS[document.getElementById('color-warning').value];
            document.getElementById('dot-normal').style.background = colorCSS[document.getElementById('color-normal').value];
            document.getElementById('dot-alert').style.background = colorCSS[document.getElementById('alert-color').value];
        }
        
        function updateBadgePreview() {
            var text = document.getElementById('alert-text').value || '‚ö†Ô∏è EN RETARD';
            var color = document.getElementById('alert-color').value;
            var preview = document.getElementById('badge-preview-sample');
            preview.textContent = text;
            preview.style.background = colorCSS[color];
        }
        
        function toggleAlertOptions() {
            var enabled = document.getElementById('alert-enabled').checked;
            document.getElementById('alert-options').style.opacity = enabled ? '1' : '0.4';
            document.getElementById('alert-options').style.pointerEvents = enabled ? 'auto' : 'none';
        }
        
        function loadSettings() {
            t.get('board', 'shared', 'countdownSettings')
                .then(function(settings) {
                    settings = settings || DEFAULT_SETTINGS;
                    
                    document.getElementById('alert-enabled').checked = settings.overdueAlert?.enabled !== false;
                    document.getElementById('alert-text').value = settings.overdueAlert?.text || '‚ö†Ô∏è EN RETARD';
                    document.getElementById('alert-color').value = settings.overdueAlert?.color || 'red';
                    
                    document.getElementById('color-overdue').value = settings.colors?.overdue || 'red';
                    document.getElementById('color-urgent').value = settings.colors?.urgent || 'orange';
                    document.getElementById('color-warning').value = settings.colors?.warning || 'yellow';
                    document.getElementById('color-normal').value = settings.colors?.normal || 'blue';
                    
                    document.getElementById('threshold-urgent').value = settings.thresholds?.urgent || 24;
                    document.getElementById('threshold-warning').value = settings.thresholds?.warning || 72;
                    
                    var format = settings.format || 'short';
                    document.getElementById('format-' + format).checked = true;
                    document.querySelectorAll('.format-option').forEach(function(o) { o.classList.remove('selected'); });
                    document.querySelector('.format-option[data-format="' + format + '"]').classList.add('selected');
                    
                    updateColorDots();
                    updateBadgePreview();
                    toggleAlertOptions();
                });
        }
        
        function saveSettings() {
            var settings = {
                thresholds: {
                    urgent: parseInt(document.getElementById('threshold-urgent').value) || 24,
                    warning: parseInt(document.getElementById('threshold-warning').value) || 72
                },
                colors: {
                    overdue: document.getElementById('color-overdue').value,
                    urgent: document.getElementById('color-urgent').value,
                    warning: document.getElementById('color-warning').value,
                    normal: document.getElementById('color-normal').value
                },
                format: document.querySelector('input[name="format"]:checked').value,
                overdueAlert: {
                    enabled: document.getElementById('alert-enabled').checked,
                    text: document.getElementById('alert-text').value || '‚ö†Ô∏è EN RETARD',
                    color: document.getElementById('alert-color').value
                }
            };
            
            t.set('board', 'shared', 'countdownSettings', settings)
                .then(function() {
                    var msg = document.getElementById('success-message');
                    msg.style.display = 'block';
                    setTimeout(function() { msg.style.display = 'none'; }, 2000);
                });
        }
        
        function resetSettings() {
            t.set('board', 'shared', 'countdownSettings', DEFAULT_SETTINGS)
                .then(function() {
                    loadSettings();
                    var msg = document.getElementById('success-message');
                    msg.textContent = '‚úÖ Param√®tres r√©initialis√©s !';
                    msg.style.display = 'block';
                    setTimeout(function() {
                        msg.style.display = 'none';
                        msg.textContent = '‚úÖ Param√®tres enregistr√©s !';
                    }, 2000);
                });
        }
        
        // Gestion des onglets
        document.querySelectorAll('.tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
                document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
                this.classList.add('active');
                document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                t.sizeTo('body').done();
            });
        });
        
        // Gestion des options de format
        document.querySelectorAll('.format-option').forEach(function(option) {
            option.addEventListener('click', function() {
                document.querySelectorAll('.format-option').forEach(function(o) { o.classList.remove('selected'); });
                this.classList.add('selected');
                this.querySelector('input').checked = true;
            });
        });
        
        // Gestion des changements de couleur
        document.querySelectorAll('.color-select').forEach(function(select) {
            select.addEventListener('change', function() {
                updateColorDots();
                updateBadgePreview();
            });
        });
        
        document.getElementById('alert-text').addEventListener('input', updateBadgePreview);
        document.getElementById('alert-enabled').addEventListener('change', toggleAlertOptions);
        
        // Gestion des emojis
        document.getElementById('emoji-suggestions').addEventListener('click', function(e) {
            if (e.target.classList.contains('emoji-btn')) {
                var input = document.getElementById('alert-text');
                var emoji = e.target.textContent.trim();
                input.value = emoji + ' EN RETARD';
                updateBadgePreview();
            }
        });
        
        document.getElementById('save-btn').addEventListener('click', saveSettings);
        document.getElementById('reset-btn').addEventListener('click', resetSettings);
        
        t.render(function() {
            loadSettings();
            t.sizeTo('body').done();
        });
    </script>
</body>
</html>
